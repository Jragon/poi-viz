# Continuity Log

- 2026-02-07T11:04:11Z [TOOL] Reviewed `AGENTS.md` and confirmed required documentation rules include README sync plus mandatory continuity tracking at `.agent/CONTINUITY.md`.
- 2026-02-07T11:04:11Z [CODE] Added and validated Phase 3 engine modules under `src/engine` with deterministic math (`getAngles`, `getPositions`, `sampleLoop`) and fixed-step trail sampling.
- 2026-02-07T11:04:11Z [TOOL] Verified current code health after Phase 3 with passing `npm run test` and `npm run build`.
- 2026-02-07T11:04:11Z [CODE] Updated `README.md` to reflect Phase 3 implementation status, math equations, engine API, and current test coverage.
- 2026-02-07T11:05:47Z [USER] Requested walkthrough of Phase 4 implementation planning before coding.
- 2026-02-07T11:05:47Z [ASSUMPTION] Phase 4 scope is the `spec.md` validation loop only: invariants, special-case geometry checks, fixture generation, and fixture comparison tests with documented tolerances.
- 2026-02-07T11:09:43Z [USER] Requested execution of the next implementation phase plus explicit logging, next-step callout, and test instructions.
- 2026-02-07T11:09:43Z [CODE] Implemented Phase 4 test layer: tolerance helpers, invariants suite, special-cases suite, and a fixture comparison harness under `tests/engine`.
- 2026-02-07T11:09:43Z [TOOL] Verified Phase 4 with passing `npm run test` (23 tests) and `npm run build`.
- 2026-02-07T11:09:43Z [ASSUMPTION] Next phase is Phase 5: replace fixture scaffold generation with real golden position fixtures and add file-backed fixture regression tests using the harness.
- 2026-02-07T11:13:06Z [USER] Requested comprehensive engine documentation to support understanding and teaching.
- 2026-02-07T11:13:06Z [CODE] Added API-level JSDoc across engine modules and created `src/engine/README.md` with equations, API mapping, determinism notes, and a worked example.
- 2026-02-07T11:13:06Z [CODE] Updated `README.md` to point to dedicated engine documentation.
- 2026-02-07T11:14:24Z [USER] Requested planning walkthrough for the next implementation phase.
- 2026-02-07T11:14:24Z [ASSUMPTION] Next phase scope is Phase 5 only: replace fixture placeholder generation with real preset position fixtures and add file-backed regression tests.
- 2026-02-07T11:18:17Z [CODE] Completed Phase 5 implementation: replaced fixture placeholder script with deterministic preset fixture generation, added fixture schema utilities in `src/engine/fixtures.ts`, and generated `fixtures/*.json`.
- 2026-02-07T11:18:17Z [CODE] Added file-backed regression suite `tests/engine/fixtures.test.ts` using fixture harness comparisons at fixture tolerance.
- 2026-02-07T11:18:17Z [CODE] Updated `README.md` and `src/engine/README.md` to document Phase 5 fixture workflow and testability.
- 2026-02-07T11:18:17Z [ASSUMPTION] Next implementation phase is Phase 6: Canvas renderers and render-sync wiring (`PatternCanvas.vue`, `WaveCanvas.vue`).
- 2026-02-07T11:19:27Z [CODE] Hardened fixture manifest generation to derive and validate uniform `sampleHz`/`startBeat` from generated payloads.
- 2026-02-07T11:19:27Z [TOOL] Re-ran full Phase 5 validation: `npm run gen:fixtures`, `npm run test` (25 tests), and `npm run build` all passed.
- 2026-02-07T11:20:31Z [USER] Approved Phase 6 implementation and requested execution.
- 2026-02-07T11:26:29Z [CODE] Implemented Phase 6 render layer: added Canvas render modules in `src/render`, created `src/components/PatternCanvas.vue` and `src/components/WaveCanvas.vue`, and rewired `src/App.vue` to responsive 3-panel layout with synced RAF playhead.
- 2026-02-07T11:26:29Z [CODE] Added render helper tests in `tests/render/pattern-renderer.test.ts` and `tests/render/wave-renderer.test.ts`.
- 2026-02-07T11:26:29Z [TOOL] Verified Phase 6 with passing `npm run test` (31 tests) and `npm run build`.
- 2026-02-07T11:26:29Z [ASSUMPTION] Next phase is Phase 7: implement full `Controls.vue` with transport/params/presets/toggles and move temporary controls out of `App.vue`.
- 2026-02-07T11:20:31Z [USER] Requested implementation plan for Phase 6.
- 2026-02-07T11:20:31Z [TOOL] Confirmed current UI is still scaffold-only in `src/App.vue`; canvas components and renderer modules are not yet present.
- 2026-02-07T11:20:31Z [ASSUMPTION] Phase 6 scope is render-layer only: implement `PatternCanvas.vue` + `WaveCanvas.vue`, renderer modules, and playhead sync wiring without full controls/persistence work.
- 2026-02-07T11:28:23Z [USER] Requested documentation file paths to be project-root-relative instead of absolute workspace paths.
- 2026-02-07T11:28:23Z [CODE] Normalized path references in `README.md` and `.agent/CONTINUITY.md` from absolute to project-relative format.
- 2026-02-07T11:29:35Z [USER] Requested planning walkthrough for Phase 7 implementation.
- 2026-02-07T11:29:35Z [ASSUMPTION] Phase 7 scope is controls UI and state mutation wiring only (transport, parameters, presets, toggles), while URL/localStorage persistence remains Phase 8.
- 2026-02-07T11:33:59Z [USER] Approved Phase 7 execution.
- 2026-02-07T11:33:59Z [CODE] Implemented `src/components/Controls.vue` with transport, scrub, global settings, per-hand parameter editing, trail/wave toggles, and element/flower preset buttons.
- 2026-02-07T11:33:59Z [CODE] Added pure state action layer in `src/state/actions.ts` and preset-id action support in `src/state/presets.ts`; rewired `src/App.vue` to commit control events through action helpers.
- 2026-02-07T11:33:59Z [CODE] Added `tests/state/actions.test.ts` and updated `README.md` Phase status/controls workflow documentation.
- 2026-02-07T11:33:59Z [TOOL] Verified Phase 7 with passing `npm run test` (37 tests) and `npm run build`.
- 2026-02-07T11:33:59Z [ASSUMPTION] Next phase is Phase 8: URL querystring state sharing + localStorage restore/sync + copy-link action.
- 2026-02-07T11:41:12Z [USER] Requested degree/radian input mode support and clearer on-page explanations for each parameter.
- 2026-02-07T11:41:12Z [CODE] Added `src/state/angleUnits.ts`, wired angle-unit switching in `src/components/Controls.vue` (defaulting to degrees display), and kept engine/state values in radians.
- 2026-02-07T11:41:12Z [CODE] Expanded controls UI with parameter-level helper text describing behavior for global settings, hand fields, toggles, and presets.
- 2026-02-07T11:41:12Z [CODE] Added `tests/state/angle-units.test.ts` and updated `README.md` controls/test documentation.
- 2026-02-07T11:41:12Z [TOOL] Verified post-change stability with passing `npm run test` (40 tests) and `npm run build`.
- 2026-02-07T11:45:16Z [USER] Requested transport to be a single box above global controls and asked for a detailed explanatory text box below controls.
- 2026-02-07T11:45:16Z [CODE] Restructured `src/components/Controls.vue` so transport is a full-width top panel, moved global settings below it, and added a detailed "How This Works and How To Use It" guidance box beneath the control sections.
- 2026-02-07T11:45:16Z [CODE] Updated `README.md` controls workflow notes to reflect the new layout and explanatory help box.
- 2026-02-07T11:45:16Z [TOOL] Verified UI change safety with passing `npm run test` (40 tests) and `npm run build`.
- 2026-02-07T11:51:31Z [USER] Requested final phase implementation, repo cleanup, and final UX pass while keeping Phase 8 skipped for now.
- 2026-02-07T11:51:31Z [CODE] Completed Phase 9 closure: updated `src/App.vue` responsive integration messaging and made waveform panel conditional so pattern viewport expands when waves are toggled off.
- 2026-02-07T11:51:31Z [CODE] Updated `README.md` status to mark Phase 9 complete and Phase 8 explicitly deferred as TODO; documented final UX integration behavior and validation loop.
- 2026-02-07T11:51:31Z [TOOL] Ran end-state validation successfully: `npm run gen:fixtures`, `npm run test` (40 passing), `npm run build`.
- 2026-02-07T11:51:31Z [ASSUMPTION] Remaining scoped work is Phase 8 only (URL query/localStorage persistence + copy-link flow).
- 2026-02-07T11:53:07Z [USER] Requested removal of the Phase 9 status paragraph from app header and reported canvas overflow outside panel boxes.
- 2026-02-07T11:53:07Z [CODE] Updated `src/App.vue` to remove header status copy and switched viewport/wave panel cards to `flex` column layout with `min-h-0 flex-1` canvas containers to prevent overflow.
- 2026-02-07T11:53:07Z [TOOL] Verified runtime integrity after layout fix with passing `npm run build`.
- 2026-02-07T11:55:06Z [USER] Requested a complete README rewrite as polished single-page documentation for the whole codebase, not phase-oriented notes.
- 2026-02-07T11:55:06Z [CODE] Replaced `README.md` with holistic documentation covering product purpose, implemented vs pending features, architecture/data flow, math model, state/controls/presets, rendering behavior, deterministic sampling, fixtures, tests, project structure, and deployment.
- 2026-02-07T12:07:49Z [USER] Provided GitHub Pages target URL `https://jragon.github.io/poi-viz/` and implied Pages base-path alignment.
- 2026-02-07T12:07:49Z [CODE] Updated `vite.config.ts` to use `base: "/poi-viz/"` on build and `"/"` in dev so production assets resolve under project Pages URL.
- 2026-02-07T12:07:49Z [TOOL] Verified configuration with passing `npm run build`.
- 2026-02-07T12:12:55Z [USER] Requested new defaults: bpm 10; both arm speeds 360 deg/beat with zero phase (earth timing); right poi relative speed 0 (extension); left poi relative speed -3 circles per arm circle (3-petal antispin baseline).
- 2026-02-07T12:12:55Z [CODE] Updated default constants/state wiring in `src/state/constants.ts` and `src/state/defaults.ts` to encode the new baseline with explicit per-hand relative poi cycle constants.
- 2026-02-07T12:12:55Z [CODE] Updated `tests/state/defaults.test.ts` expectations and README default-parameter documentation; regenerated fixture files via `npm run gen:fixtures` to match new default-driven fixture metadata/outputs.
- 2026-02-07T12:12:55Z [CODE] Relaxed exact float equality assertions in `tests/engine/trails.test.ts` to tolerance-based checks after bpm change exposed floating-point endpoint representation.
- 2026-02-07T12:12:55Z [TOOL] Verified with passing `npm run test` (40 tests) and `npm run build`.
- 2026-02-07T12:16:12Z [USER] Requested adding the GitHub Pages URL near the top of README for quick access.
- 2026-02-07T12:16:12Z [CODE] Added a top-level live demo link to `README.md`: `https://jragon.github.io/poi-viz/`.
- 2026-02-07T12:17:27Z [USER] Requested startup playback to be enabled by default.
- 2026-02-07T12:17:27Z [CODE] Set `isPlaying` default to `true` in `src/state/defaults.ts`, updated default-state expectations in `tests/state/defaults.test.ts`, and made playback-toggle test assertion state-relative in `tests/state/actions.test.ts`.
- 2026-02-07T12:17:27Z [CODE] Updated README defaults section to document `isPlaying = true` startup behavior.
- 2026-02-07T12:17:27Z [TOOL] Verified with passing `npm run test` (40 tests).
- 2026-02-07T12:42:13Z [USER] Requested a poi-centric speed model using cycles/beat with radians kept internal, plus editable relative and absolute head speed controls.
- 2026-02-07T12:42:13Z [CODE] Added `src/state/speedUnits.ts` with pure conversions (`cycles/beat`, `deg/beat`), absolute/relative speed transforms (`h=a+r`, `r=h-a`), and spin-mode classification.
- 2026-02-07T12:42:13Z [CODE] Refactored `src/components/Controls.vue` to support separate phase/speed unit selectors, direct editing of relative poi speed `r` and absolute head speed `h`, and derived live readouts (`a`, `r`, `h`, mode, `r/a`) per hand.
- 2026-02-07T12:42:13Z [CODE] Added `tests/state/speed-units.test.ts` and updated README documentation to explain the new speed-language model and controls behavior.
- 2026-02-07T12:42:13Z [TOOL] Verified with passing `npm run test` (45 tests) and `npm run build`.
- 2026-02-07T12:50:48Z [USER] Requested defaults and controls UX updates: poi radius 100 with arm radius 120, blur-based numeric validation to allow typing negatives/partials, whole-number arrow increments, rename zero-arm case to `static-spin`, and simplify poi speed to absolute head speed by default with advanced toggle for extra parameters.
- 2026-02-07T12:50:48Z [CODE] Updated defaults by setting `DEFAULT_POI_RADIUS = 100` in `src/state/constants.ts`; regenerated `fixtures/*.json` to align with new default geometry.
- 2026-02-07T12:50:48Z [CODE] Refactored `src/components/Controls.vue` numeric input handling to draft-on-input + commit-on-blur behavior across number fields, added enter-to-blur commit, and set control step increments to whole numbers.
- 2026-02-07T12:50:48Z [CODE] Simplified poi speed UI to absolute head speed `h` as the default editable control, added `Show Advanced` toggle for relative speed `r` and derived readouts, and kept radians internal.
- 2026-02-07T12:50:48Z [CODE] Updated spin mode classification to return `static-spin` (formerly `indeterminate`) in `src/state/speedUnits.ts`; adjusted `tests/state/speed-units.test.ts` and README control/default docs.
- 2026-02-07T12:50:48Z [TOOL] Verified with passing `npm run gen:fixtures`, `npm run test` (45 tests), and `npm run build`.
- 2026-02-07T12:58:00Z [USER] Requested starting Phase 8 so patterns can be saved/shareable.
- 2026-02-07T12:58:00Z [CODE] Implemented Phase 8 persistence module `src/state/persistence.ts` with versioned state serialization, URL encode/decode, localStorage decode, URL-first hydration precedence, and action-based sanitizing/clamping during restore.
- 2026-02-07T12:58:00Z [CODE] Wired `src/App.vue` to hydrate from URL/localStorage on mount, debounce sync state to URL + localStorage, and provide copy-link behavior with success/error feedback.
- 2026-02-07T12:58:00Z [CODE] Extended `src/components/Controls.vue` transport with a copy-link button and label feedback prop/event.
- 2026-02-07T12:58:00Z [CODE] Added `tests/state/persistence.test.ts` and updated README documentation to mark persistence/share-link as implemented.
- 2026-02-07T12:58:00Z [TOOL] Verified with passing `npm run test` (50 tests) and `npm run build`.
- 2026-02-07T13:07:10Z [USER] Requested no long URL state during editing and asked for app-storage multi-preset save/load workflow with JSON export for building future system presets.
- 2026-02-07T13:07:10Z [CODE] Changed persistence behavior in `src/App.vue` to keep URL clean during normal editing (localStorage session sync only), while preserving on-demand share-link generation and legacy URL-state hydration support.
- 2026-02-07T13:07:10Z [CODE] Added preset library domain module `src/state/presetLibrary.ts` for deterministic preset IDs, storage serialization, single-preset import/export payloads, and utility CRUD transforms.
- 2026-02-07T13:07:10Z [CODE] Added Preset Library UI in `src/components/Controls.vue` with save current, load, delete, export JSON, and import JSON actions; wired these events and feedback handling in `src/App.vue`.
- 2026-02-07T13:07:10Z [CODE] Added tests `tests/state/preset-library.test.ts`, expanded `tests/state/persistence.test.ts`, and updated README docs for the new session persistence + preset library workflow.
- 2026-02-07T13:07:10Z [TOOL] Verified with passing `npm run test` (57 tests) and `npm run build`.
- 2026-02-07T13:10:24Z [USER] Requested human-readable preset exports in cycles/beat or currently selected units instead of raw radians.
- 2026-02-07T13:10:24Z [CODE] Updated preset export format in `src/state/presetLibrary.ts` to schema v2 with explicit `units` metadata and unit-converted speed/phase values; imports now support both v2 human-readable files and legacy v1 radian files.
- 2026-02-07T13:10:24Z [CODE] Wired `Controls.vue` export action to pass selected `speedUnit`/`phaseUnit` and updated `App.vue` export handler accordingly.
- 2026-02-07T13:10:24Z [CODE] Extended tests in `tests/state/preset-library.test.ts` for unit-aware export payload validation and legacy import compatibility; updated README export notes.
- 2026-02-07T13:10:24Z [TOOL] Verified with passing `npm run test` (58 tests) and `npm run build`.
- 2026-02-07T16:59:06Z [USER] Requested Phase 1 VTG implementation: collapsible VTG grid panel, pure VTG descriptor generator/classifiers, and tests without engine-math changes.
- 2026-02-07T16:59:06Z [CODE] Added pure VTG domain modules in `src/vtg` (`types.ts`, `classify.ts`, `generate.ts`) with canonical descriptor generation, ±5° phase bucketing, and deterministic classifier validation.
- 2026-02-07T16:59:06Z [CODE] Added collapsible VTG controls in `src/components/Controls.vue` (petals/spin/phase selectors, 4×4 arm×poi grid, help text, current VTG readout) and wired VTG apply handling in `src/App.vue`.
- 2026-02-07T16:59:06Z [CODE] Added VTG regression coverage in `tests/vtg/generate.test.ts` for generator/classifier consistency, phase tolerance behavior, finite param sanity, and sampled invariants.
- 2026-02-07T16:59:06Z [TOOL] Verified updates with passing `npm test` (61 tests) and `npm run build`.
- 2026-02-07T17:09:03Z [USER] Requested VTG to be extracted into a separate component mounted directly below Global Settings, and requested all controls panels to be foldable.
- 2026-02-07T17:09:03Z [CODE] Extracted VTG UI/state logic from `src/components/Controls.vue` into new `src/components/VtgPanel.vue` and wired `apply-vtg` through the parent controls emitter.
- 2026-02-07T17:09:03Z [CODE] Refactored controls layout so transport, global settings, hand panels, presets, preset library, VTG, and help are all foldable `<details>` panels; VTG now renders immediately below Global Settings.
- 2026-02-07T17:09:03Z [CODE] Updated `README.md` controls/architecture sections to reflect `VtgPanel.vue`, VTG placement, and foldable panel behavior.
- 2026-02-07T17:09:03Z [TOOL] Verified with passing `npm test` (61 tests) and `npm run build`.
- 2026-02-07T17:15:49Z [USER] Reported VTG bugs: Water/Fire grid selection mismatch, petal changes not updating visualization, requested replacing petals+spin with poi-cycles-per-arm-cycle, and phase selector semantics fix.
- 2026-02-07T17:15:49Z [CODE] Identified likely causes in `src/components/VtgPanel.vue` and `src/vtg/classify.ts`: selector controls only apply on cell click and phase/timing bucket aliasing can collapse Water/Fire to Earth/Air for overlapping phase deltas.
- 2026-02-07T17:15:49Z [ASSUMPTION] `poi cycles per arm cycle` mapping is ambiguous without an explicit sign convention; implementation plan will include a normalization rule and requires user confirmation if they want unsigned vs signed cycles semantics.
- 2026-02-07T17:25:55Z [USER] Confirmed signed cycles model and requested implementation of VTG bug fixes plus control semantics updates.
- 2026-02-07T17:25:55Z [CODE] Reworked VTG descriptor to use signed `poiCyclesPerArmCycle` and removed `petals`/`spinMode` from `src/vtg/types.ts`, generator, UI wiring, and tests.
- 2026-02-07T17:25:55Z [CODE] Updated VTG generator/classifier semantics: phase now sets left-head orientation bucket while poi timing classification is resolved independently to prevent Water/Fire aliasing into Earth/Air.
- 2026-02-07T17:25:55Z [CODE] Refactored `src/components/VtgPanel.vue` controls to signed cycles + phase, immediate apply on cycles/phase changes, explicit selected-cell highlighting, and updated help/readouts.
- 2026-02-07T17:25:55Z [CODE] Expanded VTG regression coverage in `tests/vtg/generate.test.ts` for Water/Fire classification stability, signed cycles mapping, and phase-orientation effect.
- 2026-02-07T17:25:55Z [TOOL] Verified with passing `npm test` (64 tests) and `npm run build`.
- 2026-02-07T17:33:36Z [USER] Requested VTG controls layout tweak to place poi head cycle control and phase selector on one line.
- 2026-02-07T17:33:36Z [CODE] Updated `src/components/VtgPanel.vue` selector-row layout to a single horizontal flex row with overflow support while preserving existing control behavior.
- 2026-02-07T17:33:36Z [TOOL] Verified with passing `npm run build`.
- 2026-02-07T17:36:34Z [USER] Requested VTG selector refinements: phase aligned right, hide native number input arrows, and disallow zero cycles to avoid divide-by-zero style failures.
- 2026-02-07T17:36:34Z [CODE] Updated `src/components/VtgPanel.vue` to right-align phase controls, hide browser number spinners via scoped CSS, and enforce non-zero signed cycles with zero-skipping step behavior.
- 2026-02-07T17:36:34Z [CODE] Enforced non-zero `poiCyclesPerArmCycle` validation in `src/vtg/generate.ts` and added zero-rejection coverage in `tests/vtg/generate.test.ts`.
- 2026-02-07T17:36:34Z [TOOL] Verified with passing `npm test` (65 tests) and `npm run build`.
- 2026-02-07T17:39:13Z [USER] Requested removal of Element Presets and Flower Presets control panels.
- 2026-02-07T17:39:13Z [CODE] Removed element/flower preset panels from `src/components/Controls.vue` and deleted related preset UI emit wiring/imports.
- 2026-02-07T17:39:13Z [CODE] Removed unused preset apply handler wiring in `src/App.vue` and updated controls help copy to focus on VTG + hand tuning workflow.
- 2026-02-07T17:39:13Z [CODE] Updated `README.md` controls/data-flow docs to reflect removed preset panels while preserving programmatic preset-system notes.
- 2026-02-07T17:39:13Z [TOOL] Verified with passing `npm test` (65 tests) and `npm run build`.
- 2026-02-07T17:40:13Z [USER] Requested default panel-state changes: Global Settings and Preset Library hidden by default, while How To Use remains expanded.
- 2026-02-07T17:40:13Z [CODE] Updated `src/components/Controls.vue` details defaults so Global Settings and Preset Library start collapsed; retained open default for How To Use panel.
- 2026-02-07T17:40:13Z [CODE] Updated `README.md` controls reference to document default panel states.
- 2026-02-07T17:40:13Z [TOOL] Verified with passing `npm run build`.
- 2026-02-07T17:41:50Z [USER] Requested moving the copy-link button to the top-right header area and renaming the title text to "Poi Visuliser".
- 2026-02-07T17:41:50Z [CODE] Updated `src/App.vue` header layout to include copy-link action button at top-right and changed title text to `Poi Visuliser`; removed copy-link wiring from transport controls.
- 2026-02-07T17:41:50Z [CODE] Updated `README.md` controls/persistence notes to reflect copy-link now living in the header instead of Transport panel.
- 2026-02-07T17:41:50Z [TOOL] Verified with passing `npm run build`.
- 2026-02-07T17:48:43Z [USER] Requested a surgical VTG clarification pass: formalize Earth/Air/Water/Fire definitions as relation-based, fix phase/orientation ambiguity, add rotation-invariance tests, and update documentation.
- 2026-02-07T17:48:43Z [CODE] Replaced `src/vtg/classify.ts` with explicit authoritative classifiers (timing+direction only) plus descriptive-only cardinal helpers (`describeElement/Arm/PoiGeometryAtCardinals`) and docstrings separating authoritative vs descriptive logic.
- 2026-02-07T17:48:43Z [CODE] Added `tests/vtg/classify.test.ts` covering global-rotation invariance for arm/poi element classification and canonical together/apart cardinal mapping checks for both arm and poi helpers.
- 2026-02-07T17:48:43Z [CODE] Updated `README.md` with an "Elements vs Orientation" section documenting coordinate conventions, rotation invariance, cardinal interpretation table, and authoritative timing/direction mapping.
- 2026-02-07T17:48:43Z [TOOL] Verified with passing `npm test` (67 tests) and `npm run build`.
- 2026-02-07T17:55:33Z [USER] Reported VTG UI mismatch where selecting Air appeared to render Fire geometry and requested a one-pass fix.
- 2026-02-07T17:55:33Z [CODE] Corrected VTG element relation mapping in `src/vtg/types.ts` so Air maps to split-time+opposite-direction and Fire maps to same-time+opposite-direction, aligning generator/classifier labels with intended cardinal behavior.
- 2026-02-07T17:55:33Z [CODE] Updated `src/vtg/classify.ts` descriptive helpers to compute together/apart at cardinals from actual arm/head kinematics instead of label lookup, while keeping authoritative classification strictly timing+direction based.
- 2026-02-07T17:55:33Z [CODE] Updated `README.md` mapping text to reflect corrected Air/Fire relation definitions.
- 2026-02-07T17:55:33Z [TOOL] Verified with passing `npm test` (67 tests) and `npm run build`.
- 2026-02-07T17:57:19Z [USER] Requested VTG panel layout change: place derived readout, current VTG state, and help block at the bottom of the VTG box.
- 2026-02-07T17:57:19Z [CODE] Reordered `src/components/VtgPanel.vue` so the 4x4 grid appears first and the derived/current/help blocks render at the bottom; derived line now consistently displays in cycles/beat.
- 2026-02-07T17:57:19Z [TOOL] Verified with passing `npm run build`.
- 2026-02-07T18:15:41Z [USER] Requested full documentation system: VitePress guide pages, TypeDoc API output, JSDoc upgrades, docs hygiene lint/CI, and docs-to-tests contract links without engine behavior changes.
- 2026-02-07T18:15:41Z [CODE] Added documentation stack with VitePress (`docs/` pages + `.vitepress/config.ts`), TypeDoc config/output (`typedoc.json`, `tsconfig.typedoc.json`, `docs/api`), ESLint JSDoc enforcement (`eslint.config.mjs`), and CI workflow (`.github/workflows/ci.yml`).
- 2026-02-07T18:15:41Z [CODE] Upgraded JSDoc coverage across exported functions in `src/engine`, `src/vtg`, and `src/state`; added state/type contract doc comments and type-only refactors in `src/state/defaults.ts`, `src/vtg/generate.ts`, and `src/engine/engine.ts` to keep TypeDoc generation green without runtime semantic changes.
- 2026-02-07T18:15:41Z [CODE] Updated `README.md` with documentation tooling commands, docs architecture paths, and CI verification contract.
- 2026-02-07T18:15:41Z [TOOL] Verified with passing `npm run lint`, `npm test` (67 tests), `npm run docs:all` (TypeDoc warnings only, build succeeded), and `npm run build`.
- 2026-02-07T18:18:18Z [USER] Requested replacing `README.md` with a concise app overview that points to detailed docs, and updating `AGENTS.md` to enforce ongoing documentation maintenance.
- 2026-02-07T18:18:18Z [CODE] Rewrote `README.md` to an overview-first format with a documentation map and contributor workflow links into `docs/*` and `docs/api/index.html`.
- 2026-02-07T18:18:18Z [CODE] Updated `AGENTS.md` documentation rules and Definition of Done to require `docs/` updates, TypeDoc regeneration for API-surface changes, and `npm run docs:all` for docs/API-affecting changes.
- 2026-02-07T18:26:08Z [USER] Requested implementation of docs deployment at `/poi-viz/docs` with docs API output excluded from source control.
- 2026-02-07T18:26:08Z [CODE] Updated `docs/.vitepress/config.ts` with `base: "/poi-viz/docs/"` and updated `.github/workflows/deploy-pages.yml` to merge `docs/.vitepress/dist` and `docs/api` into `dist/docs` before Pages artifact upload.
- 2026-02-07T18:26:08Z [TOOL] Verified locally by running `npm run docs:all`, `npm run build`, and artifact merge checks confirming `dist/docs/index.html` and `dist/docs/api/index.html` are produced.
- 2026-02-07T18:35:35Z [USER] Requested fixing trails while scrubbing backwards and asked for an implementation plan first.
- 2026-02-07T18:35:35Z [TOOL] Audited `src/engine/trails.ts`, `src/components/PatternCanvas.vue`, `src/App.vue`, and `tests/engine/trails.test.ts`; rewind path currently reseeds at current beat with a single sample.
- 2026-02-07T18:35:35Z [ASSUMPTION] Backward scrub issue is that rewind resets lose trail history; deterministic rewind should repopulate the trailing window ending at current beat instead of leaving only one point.
- 2026-02-07T18:38:03Z [USER] Approved implementing the backward-scrub trail fix.
- 2026-02-07T18:38:03Z [CODE] Updated `src/engine/trails.ts` rewind path to rebuild a full deterministic trailing window ending at current `frameBeat` using fixed beat-step sampling, instead of reseeding a single sample.
- 2026-02-07T18:38:03Z [CODE] Updated `tests/engine/trails.test.ts` to validate rewind window population and added a determinism regression asserting identical rewind windows regardless of prior forward history.
- 2026-02-07T18:38:03Z [CODE] Updated trail rewind behavior docs in `README.md`, `docs/engine-architecture.md`, and `src/engine/README.md`.
- 2026-02-07T18:38:03Z [TOOL] Verified with passing `npm test` (68 tests) and `npm run build`.
- 2026-02-07T18:42:28Z [USER] Requested a transport-level static visualizer mode to capture a pattern image without running playback, with implementation plan first and then execution.
- 2026-02-07T18:42:28Z [CODE] Added transport static-view wiring across `src/components/Controls.vue` and `src/App.vue` (`set-static-view` event, static toggle UI, playback pause on enable, and static-aware play control behavior).
- 2026-02-07T18:42:28Z [CODE] Added deterministic full-loop static trail generation in `src/render/staticTrails.ts` and integrated it in `src/components/PatternCanvas.vue` so static mode renders full-loop still traces while normal mode keeps incremental trail sampling.
- 2026-02-07T18:42:28Z [CODE] Added `tests/render/static-trails.test.ts` to validate static trail generation against sampled head positions and deterministic repeatability.
- 2026-02-07T18:42:28Z [CODE] Updated docs in `README.md`, `docs/index.md`, and `docs/engine-architecture.md` to document static full-loop transport view behavior.
- 2026-02-07T18:42:28Z [TOOL] Verified with passing `npm test` (70 tests), `npm run build`, and `npm run docs:all` (TypeDoc warnings only).
- 2026-02-08T06:27:48Z [USER] Requested configurable global phase-reference system with default `down`, canonical-engine preservation, strict no-migration persistence break policy, and full VTG/preset/persistence/docs/test updates.
- 2026-02-08T06:27:48Z [CODE] Added global phase-reference contract (`PhaseReference`, default `down`) plus pure conversion helpers in `src/state/phaseReference.ts`; updated controls and VTG UI semantics to be reference-relative while keeping engine math canonical.
- 2026-02-08T06:27:48Z [CODE] Updated VTG generator/classifier APIs to accept phase-reference context for orientation buckets, kept element classification relation-based/invariant, and reconciled element mapping consistency across VTG and state presets (Air=split+opposite, Fire=same+opposite).
- 2026-02-08T06:27:48Z [CODE] Applied persistence break policy: bumped state/preset schemas, removed legacy migration paths, added compatibility checks, and wired startup purge of incompatible local keys for app state and preset library.
- 2026-02-08T06:27:48Z [CODE] Added/updated tests for phase-reference helpers, VTG multi-reference behavior, persistence schema invalidation, preset metadata enforcement, and updated preset mapping expectations; regenerated fixtures because preset mapping changes altered numeric outputs.
- 2026-02-08T06:27:48Z [CODE] Updated documentation in `README.md`, `docs/math-model.md`, `docs/engine-architecture.md`, `docs/vtg-layer.md`, `docs/glossary.md`, and `docs/validation.md`; regenerated TypeDoc output under `docs/api`.
- 2026-02-08T06:27:48Z [TOOL] Verified with passing `npm run gen:fixtures`, `npm test` (83 tests), `npm run build`, and `npm run docs:all` (TypeDoc warnings only).
- 2026-02-08T04:35:11Z [USER] Requested a daytime-friendly light theme plus a header theme switcher, with implementation plan first and then execution.
- 2026-02-08T04:35:11Z [CODE] Added persisted theme state in `src/state/theme.ts`, wired header toggle + document theme application in `src/App.vue`, and introduced renderer palettes in `src/render/theme.ts` so both pattern and wave canvases switch palettes without changing engine math.
- 2026-02-08T04:35:11Z [CODE] Updated `src/style.css` with dark/light token overrides for existing Tailwind utility classes, threaded theme props through `src/components/PatternCanvas.vue` and `src/components/WaveCanvas.vue`, added `tests/state/theme.test.ts`, and updated `README.md`.
- 2026-02-08T04:35:11Z [TOOL] Verified with passing `npm test` (74 tests) and `npm run build`.
- 2026-02-08T06:04:17Z [USER] Requested ideation-only deep analysis of engine and VTG semantics, including world-space vs engine-space timing/direction mismatch for opposite-direction together patterns.
- 2026-02-08T06:04:17Z [TOOL] Audited `README.md`, `docs/*.md`, `src/engine/*`, `src/vtg/*`, `src/state/*`, `src/render/*`, and VTG/engine tests to build a code-grounded behavior model without implementation changes.
- 2026-02-08T06:04:17Z [CODE] Identified semantic drift: VTG relation mapping in `src/vtg/types.ts` currently differs from legacy element preset mapping in `src/state/presets.ts` for Air/Fire timing-direction pairs; this may contribute to user-facing terminology confusion.
- 2026-02-08T06:39:09Z [USER] Requested authoritative element mapping update (`Earth same+same`, `Air same+opposite`, `Water split+same`, `Fire split+opposite`) and reported global phase-reference buttons appeared unlinked in UI.
- 2026-02-08T06:39:09Z [CODE] Updated VTG/preset mapping in `src/vtg/types.ts` and `src/state/presets.ts`, synchronized VTG panel controls to reactive classification/reference state in `src/components/VtgPanel.vue`, and aligned VTG descriptive/test coverage with default `phaseReference=down` interpretation.
- 2026-02-08T06:39:09Z [CODE] Updated VTG documentation mapping in `docs/vtg-layer.md` and `docs/glossary.md` and regenerated fixtures after mapping change (`npm run gen:fixtures`).
- 2026-02-08T06:39:09Z [TOOL] Verified with passing `npm test` (83 tests), `npm run build`, and `npm run docs:all` (TypeDoc warnings only).
- 2026-02-08T06:52:01Z [USER] Reported VTG values/presets still wrong and clarified expected right-hand-anchored phase/direction outcomes with global `phaseReference` zero pointing down.
- 2026-02-08T06:52:01Z [CODE] Switched VTG generation/classification phase anchoring to right hand (`src/vtg/generate.ts`, `src/vtg/classify.ts`), updated VTG panel derived cycles source/readout to right-hand head channel, and changed element-preset arm transform anchoring to derive `L` from `R` in `src/state/presets.ts`.
- 2026-02-08T06:52:01Z [CODE] Updated VTG/state tests for right-hand anchoring (`tests/vtg/generate.test.ts`, `tests/state/presets.test.ts`, `tests/state/actions.test.ts`) and refreshed VTG docs wording in `docs/vtg-layer.md` and `docs/glossary.md`.
- 2026-02-08T06:52:01Z [TOOL] Regenerated fixtures and verified with passing `npm run gen:fixtures`, `npm test` (83 tests), `npm run build`, and `npm run docs:all` (TypeDoc warnings only).
- 2026-02-08T06:58:17Z [USER] Requested VTG baseline centering so `phaseDeg=0` with `phaseReference=down` starts both hand and poi channels pointing down (not right), with hand phase semantics aligned to poi phase semantics.
- 2026-02-08T06:58:17Z [CODE] Updated `generateVTGState` so `phaseDeg` anchors the right-hand baseline for both arm and head phases, deriving left-side phases via timing offsets; updated VTG panel right-channel derived readouts and adjusted VTG docs/README wording.
- 2026-02-08T06:58:17Z [CODE] Added regression coverage in `tests/vtg/generate.test.ts` for hand-phase baseline anchoring and updated orientation-change assertions to validate absolute right arm/head orientation shifts rather than raw relative poi phase.
- 2026-02-08T06:58:17Z [TOOL] Verified with passing `npm test` (84 tests) and `npm run build`; docs generation remained green from prior `npm run docs:all` run.
- 2026-02-08T07:07:31Z [USER] Clarified VTG semantics: global phase reference should define where phase-zero points globally, while VTG phase selector should be poi-head phase offset (box/diamond rotation) and not be reinterpreted by global phase buttons.
- 2026-02-08T07:07:31Z [CODE] Refactored VTG phase semantics so `phaseDeg` is relative poi-head offset from right-arm phase (`src/vtg/classify.ts`, `src/vtg/generate.ts`) and decoupled VTG panel classification from global phase reference (`src/components/VtgPanel.vue`).
- 2026-02-08T07:07:31Z [CODE] Updated VTG docs/readme copy and tests to match offset semantics, including rotation-invariance expectations for phase bucket and hand-fixed/poi-rotated phase behavior (`tests/vtg/classify.test.ts`, `tests/vtg/generate.test.ts`, `docs/vtg-layer.md`, `docs/glossary.md`, `README.md`).
- 2026-02-08T07:07:31Z [TOOL] Verified with passing `npm test` (84 tests), `npm run build`, and `npm run docs:all` (TypeDoc warnings only).
- 2026-02-08T07:11:21Z [USER] Reported global phase-zero buttons no longer visibly linked to runtime behavior.
- 2026-02-08T07:11:21Z [CODE] Updated `setGlobalPhaseReference` in `src/state/actions.ts` to rotate both arm phases by reference-offset delta on change, restoring immediate visible global orientation effect while keeping VTG phase chips as poi-offset semantics.
- 2026-02-08T07:11:21Z [CODE] Expanded action coverage in `tests/state/actions.test.ts` to assert expected arm-phase shifts on phase-reference changes and updated phase-reference docs in `README.md` and `docs/math-model.md`.
- 2026-02-08T07:11:21Z [TOOL] Verified with passing `npm test` (84 tests), `npm run build`, and `npm run docs:all` (TypeDoc warnings only).
- 2026-02-08T07:19:28Z [USER] Requested full-repository maintainability/design review as a pre-sequencer baseline, covering engine, VTG, state, rendering, UI wiring, persistence, tests, and docs.
- 2026-02-08T07:19:28Z [TOOL] Completed read-only audit of `src/`, `tests/`, `fixtures/`, `scripts/`, and `docs/`; executed `npm test` (84 passing) and `npm run build` (passing) to separate structural risk from immediate runtime breakage.
- 2026-02-08T07:24:00Z [USER] Requested an ordered non-implementation refactor plan/spec to action maintainability findings before VTG Phase 2 sequencer work.
- 2026-02-08T07:24:00Z [ASSUMPTION] Plan will prioritize reducing competing truths and boundary leaks first, then transport/orchestration/component decomposition with added UI integration safety tests before sequencer integration.
- 2026-02-08T07:31:26Z [CODE] Added root living-plan document `refactor plan.md` with phased refactor execution order (A-I), acceptance gates, per-phase tests, rollback notes, and sequencer-ready checklist.
- 2026-02-08T07:31:26Z [CODE] Locked Rory decisions in the plan: single RAF owner, view-only phase reference semantics, URL-first hydration precedence, lean integration test strategy, and one-phase-at-a-time batching.
- 2026-02-08T07:35:15Z [CODE] Completed Refactor Phase A safety net: added jsdom-based Vue integration tests in `tests/ui/app.integration.test.ts` (hydration precedence, transport semantics, VTG apply flow) and `tests/ui/controls-input.integration.test.ts` (commit-on-blur/enter behavior).
- 2026-02-08T07:35:15Z [CODE] Updated `vitest.config.ts` with Vue plugin and `environmentMatchGlobs` so only `tests/ui/**/*.test.ts` runs in jsdom while existing suites remain node-based.
- 2026-02-08T07:35:15Z [TOOL] Verified Phase A with passing `npm test` (89 tests) and `npm run build`.
- 2026-02-08T07:35:15Z [CODE] Updated `refactor plan.md` to mark Phase A complete and logged execution notes/results.
- 2026-02-08T07:39:44Z [CODE] Completed Refactor Phase B: unified VTG relation semantics in `src/vtg/types.ts` via `VTG_ELEMENT_RELATIONS` and updated `src/state/presets.ts` to derive element preset behavior from `getRelationForElement` instead of duplicated timing/direction flags.
- 2026-02-08T07:39:44Z [CODE] Added shared phase utility module `src/state/phaseMath.ts` and reused it from `src/state/phaseReference.ts` and `src/vtg/classify.ts`, removing duplicated angle wrapping/distance logic.
- 2026-02-08T07:39:44Z [CODE] Added Phase B regression coverage in `tests/state/phase-math.test.ts` and expanded `tests/state/presets.test.ts` with VTG alignment assertions.
- 2026-02-08T07:39:44Z [TOOL] Verified Phase B with passing `npm test` (93 tests) and `npm run build`.
- 2026-02-08T07:39:44Z [CODE] Updated `refactor plan.md` to mark Phase B complete with execution notes and validation results.
- 2026-02-08T07:44:22Z [CODE] Completed Refactor Phase C boundary fix: added `src/state/beatMath.ts` and moved state playhead wrapping to this neutral utility so `src/state/actions.ts` no longer imports from `src/render/math.ts`.
- 2026-02-08T07:44:22Z [CODE] Updated `src/render/math.ts` to consume/re-export shared `normalizeLoopBeat` from `src/state/beatMath.ts` for compatibility while preserving render call sites.
- 2026-02-08T07:44:22Z [CODE] Added `tests/state/beat-math.test.ts` and expanded `tests/state/actions.test.ts` with negative playhead wrap coverage.
- 2026-02-08T07:44:22Z [TOOL] Verified Phase C with passing `npm test` (96 tests) and `npm run build`; confirmed no `src/state` imports from `src/render`.
- 2026-02-08T07:44:22Z [CODE] Updated `refactor plan.md` to mark Phase C complete with execution notes and validation results.
- 2026-02-08T07:50:19Z [CODE] Completed Refactor Phase D semantics split: `setGlobalPhaseReference` in `src/state/actions.ts` now updates phase-reference metadata only and no longer mutates canonical arm phases.
- 2026-02-08T07:50:19Z [CODE] Added/updated coverage for view-only phase-reference behavior in `tests/state/actions.test.ts`, `tests/state/persistence.test.ts`, and `tests/ui/app.integration.test.ts`.
- 2026-02-08T07:50:19Z [CODE] Updated behavior docs in `README.md`, `docs/math-model.md`, and `docs/glossary.md` to remove implicit runtime arm-rotation claims and reflect metadata-only semantics.
- 2026-02-08T07:50:19Z [TOOL] Verified Phase D with passing `npm test` (98 tests), `npm run build`, and `npm run docs:all` (TypeDoc warnings only).
- 2026-02-08T07:50:19Z [CODE] Updated `refactor plan.md` to mark Phase D complete with execution notes and validation results.
- 2026-02-08T07:58:47Z [CODE] Completed Refactor Phase E: added single RAF transport service (`src/composables/transportClock.ts`) and rewired `src/App.vue` to own transport timing through that service.
- 2026-02-08T07:58:47Z [CODE] Removed independent RAF loops from `src/components/PatternCanvas.vue` and `src/components/WaveCanvas.vue`; both canvases now redraw via prop/state invalidation and resize events.
- 2026-02-08T07:58:47Z [CODE] Added Phase E coverage in `tests/app/transport-clock.test.ts` and `tests/ui/canvas-clock.integration.test.ts`, and extended `tests/ui/app.integration.test.ts` with transport progression + cross-canvas sync assertions.
- 2026-02-08T07:58:47Z [TOOL] Verified Phase E with passing `npm test` (103 tests), `npm run build`, and source scan confirming RAF usage exists only in `src/composables/transportClock.ts`.
- 2026-02-08T08:04:22Z [CODE] Completed Refactor Phase F by adding `src/composables/persistenceCoordinator.ts` as the single owner of hydration precedence, schema compatibility purge, debounced session-state sync, and share-link URL generation.
- 2026-02-08T08:04:22Z [CODE] Refactored `src/App.vue` to consume persistence coordinator APIs and removed direct state/preset storage key compatibility logic plus app-state debounce timer handling.
- 2026-02-08T08:04:22Z [CODE] Added persistence centralization coverage in `tests/app/persistence-coordinator.test.ts` and extended `tests/ui/app.integration.test.ts` with share-link URL non-mutation assertions.
- 2026-02-08T08:04:22Z [TOOL] Verified Phase F with passing `npm test` (109 tests) and `npm run build`.
- 2026-02-08T08:05:14Z [TOOL] Re-validated post-Phase F docs/contracts with passing `npm run docs:all` (TypeDoc warnings only, build succeeded), plus prior passing `npm test` and `npm run build`.
- 2026-02-08T08:29:22Z [CODE] Completed Refactor Phase G by extracting root orchestration into `src/composables/useAppOrchestrator.ts`; `src/App.vue` now serves as a thin composition shell.
- 2026-02-08T08:29:22Z [CODE] Moved App-level concerns (transport wiring, persistence delegation, theme toggle persistence, VTG apply dispatch, preset-library handlers, copy-link/status timer flows) out of component root logic and into the orchestrator composable.
- 2026-02-08T08:29:22Z [CODE] Added orchestration module coverage in `tests/ui/app-orchestrator.integration.test.ts` and retained behavior parity under existing `tests/ui/app.integration.test.ts`.
- 2026-02-08T08:29:22Z [TOOL] Verified Phase G with passing `npm test` (112 tests), `npm run build`, and `npm run docs:all` (TypeDoc warnings only).
- 2026-02-08T09:08:42Z [USER] Challenged whether `useAppOrchestrator` was still a god-module and requested deeper modularization before Phase H.
- 2026-02-08T09:08:42Z [CODE] Decomposed `src/composables/useAppOrchestrator.ts` into focused controllers (`useTransportController`, `useThemeController`, `useShareLinkController`, `usePresetLibraryController`) while preserving external App handler contracts.
- 2026-02-08T09:08:42Z [CODE] Kept `useAppOrchestrator` as a composition facade and updated docs/plan to reflect controller-level ownership boundaries.
- 2026-02-08T09:08:42Z [TOOL] Re-validated decomposition with passing `npm test` (112 tests), `npm run build`, and `npm run docs:all` (TypeDoc warnings only).
- 2026-02-08T10:17:48Z [USER] Requested composable-standard consistency and asked why `transportClock.ts` and `persistenceCoordinator.ts` differed from other `use*` composables.
- 2026-02-08T10:17:48Z [CODE] Standardized composable naming by renaming to `src/composables/useTransportClock.ts` and `src/composables/usePersistenceCoordinator.ts` and updating imports/usages/tests/docs to `use*` conventions.
- 2026-02-08T10:17:48Z [TOOL] Verified naming-standardization changes with passing `npm test` (112 tests), `npm run build`, and `npm run docs:all` (TypeDoc warnings only).
- 2026-02-08T11:15:04Z [TOOL] Compared `main` vs `fucked`: `fucked` adds typed provide/inject control contexts and panel extraction plus render-space phase-reference rotation (`src/components/PatternCanvas.vue`, `src/render/viewTransform.ts`); no branch diff in `src/state/actions.ts`, `src/state/phaseReference.ts`, or phase semantics tests.
- 2026-02-08T11:15:04Z [CODE] Identified current hand-value changes on phase-zero toggles as UI display conversion behavior (phase fields rendered reference-relative), not canonical state mutation.
- 2026-02-08T11:23:54Z [USER] Directed continuation from `main` without reintroducing provide/inject refactor and requested phase-reference behavior where global phase updates view only (no hand-value rewrites) with integration coverage.
- 2026-02-08T11:23:54Z [CODE] Updated `src/components/Controls.vue` hand-phase conversions to be canonical-unit based (degrees/radians only), removing display coupling between hand phase fields and `global.phaseReference`.
- 2026-02-08T11:23:54Z [CODE] Added render-space phase-reference orientation rotation in `src/components/PatternCanvas.vue` using new pure helpers in `src/render/viewTransform.ts`.
- 2026-02-08T11:23:54Z [CODE] Added regression coverage in `tests/render/view-transform.test.ts`, `tests/ui/canvas-clock.integration.test.ts`, and `tests/ui/controls-input.integration.test.ts` for view rotation and stable hand-phase display under phase-reference toggles.
- 2026-02-08T11:23:54Z [TOOL] Verified with passing `npm test` (116 tests), `npm run build`, and `npm run docs:all` (TypeDoc warnings unchanged).
- 2026-02-08T11:23:54Z [CODE] Updated docs in `README.md`, `docs/math-model.md`, `docs/index.md`, and refreshed `refactor plan.md` change log.
- 2026-02-08T11:35:19Z [USER] Confirmed VTG grid must stay phase-zero anchored (Earth `0,0`; Air `0,0` opposite-direction; Water `0,180`; Fire `0,180` opposite-direction) and requested implementation.
- 2026-02-08T11:35:19Z [CODE] Removed global phase-reference coupling from VTG generation (`src/vtg/generate.ts`) so descriptor application is canonical/reference-independent; updated orchestrator call sites and VTG tests (`tests/vtg/generate.test.ts`, `tests/vtg/classify.test.ts`, `tests/ui/app.integration.test.ts`) to assert same descriptor output across phase-reference toggles.
- 2026-02-08T11:35:19Z [CODE] Updated descriptive cardinal helpers in `src/vtg/classify.ts` to evaluate in the active view reference frame, keeping docs/debug together/apart readouts aligned with default `phaseReference=down`.
- 2026-02-08T11:35:19Z [CODE] Updated VTG docs (`docs/vtg-layer.md`) to define single ownership: generator/classifier are canonical and phase-reference-invariant; render layer applies orientation.
- 2026-02-08T11:35:19Z [TOOL] Verified post-fix with passing `npm test` (117 tests), `npm run build`, and `npm run docs:all` (TypeDoc warnings only).
- 2026-02-08T11:37:09Z [CODE] Clarified VTG wording by renaming generator test language to canonical baseline semantics and updating docs text from canonical to reference-aligned cardinal descriptors.
- 2026-02-08T11:37:09Z [TOOL] Re-verified checkpoint with passing `npm test` (117 tests), `npm run build`, and `npm run docs:all` (TypeDoc warnings only).
- 2026-02-08T11:44:16Z [USER] Requested final refactor phase completion.
- 2026-02-08T11:44:16Z [CODE] Completed Phase H by decomposing `src/components/Controls.vue` into focused panel components under `src/components/controls` and adding shared numeric draft/commit utility `src/composables/useNumericDrafts.ts`; `Controls.vue` now acts as a thin coordinator over panel events/state.
- 2026-02-08T11:44:16Z [CODE] Added panel emit-contract coverage in `tests/ui/controls-panels.integration.test.ts` and kept existing controls/app integration suites green.
- 2026-02-08T11:44:16Z [CODE] Updated documentation and plan state in `README.md`, `docs/index.md`, and `refactor plan.md` to mark Phase H and Phase I sequencer-ready gate complete.
- 2026-02-08T11:44:16Z [TOOL] Verified final refactor checkpoint with passing `npm test` (121 tests), `npm run build`, and `npm run docs:all` (TypeDoc warnings only).
